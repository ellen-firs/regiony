import streamlit as st
import pandas as pd
import plotly.express as px
import json
import requests

st.set_page_config(page_title="–†–µ–π—Ç–∏–Ω–≥ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏", layout="wide")
st.title("üó∫Ô∏è –†–µ–π—Ç–∏–Ω–≥ –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏")

# –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
data = {
    '–†–µ–≥–∏–æ–Ω': [
        '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ú–æ—Å–∫–≤–∞', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞—Ä–µ–ª–∏—è', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–æ–º–∏', '–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥', 
        '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ü—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–¥—ã–≥–µ—è', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞–ª–º—ã–∫–∏—è', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º', '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π', 
        '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –î–∞–≥–µ—Å—Ç–∞–Ω', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ò–Ω–≥—É—à–µ—Ç–∏—è', 
        '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', '–ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è ‚Äì –ê–ª–∞–Ω–∏—è', '–ß–µ—á–µ–Ω—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 
        '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–∞—Ä–∏–π –≠–ª', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–æ—Ä–¥–æ–≤–∏—è', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω', '–£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 
        '–ß—É–≤–∞—à—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π', '–ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥ ‚Äî –Æ–≥—Ä–∞', 
        '–Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥', '–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–ª—Ç–∞–π', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢—ã–≤–∞', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –•–∞–∫–∞—Å–∏—è', '–ê–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π', 
        '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π', '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë—É—Ä—è—Ç–∏—è', '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)', '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π –∫—Ä–∞–π', 
        '–ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π', '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π', '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π', '–ê–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ï–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å', 
        '–ß—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥'
    ],
    '–†–∞–Ω–≥': [33, 26, 44, 27, 10, 60, 16, 46, 25, 74, 14, 24, 19, 23, 17, 39, 12, 85, 
             1, 8, 35, 6, 31, 58, 68, 37, 45, 11, 81, 48, 40, 18, 75, 38, 43, 56, 63, 
             78, 80, 72, 70, 50, 79, 59, 73, 21, 61, 76, 52, 64, 30, 4, 62, 41, 15, 
             71, 47, 34, 2, 42, 82, 84, 66, 53, 28, 51, 55, 9, 32, 13, 3, 29, 20, 36, 
             22, 69, 7, 77, 57, 65, 49, 67, 54, 5, 83]
}

df = pd.DataFrame(data)
df['–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–Ω–æ—Å—Ç–∏'] = 86 - df['–†–∞–Ω–≥']

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ GeoJSON —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
@st.cache_data
def load_geojson_with_crimea():
    try:
        # –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        url = "https://raw.githubusercontent.com/mapswe/russian-regions-geojson/master/russia.geojson"
        response = requests.get(url)
        if response.status_code == 200:
            geojson = response.json()
            st.success("‚úÖ –ö–∞—Ä—Ç–∞ –†–æ—Å—Å–∏–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!")
            return geojson
    except Exception as e:
        st.warning(f"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω: {e}")
    
    # –ï—Å–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º –±–∞–∑–æ–≤—ã–π
    try:
        base_url = "https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/russia.geojson"
        response = requests.get(base_url)
        if response.status_code == 200:
            geojson = response.json()
            
            # –î–æ–±–∞–≤–ª—è–µ–º –ö—Ä—ã–º –∏ –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å
            crimea_coords = [
                [32.5, 44.5], [36.5, 44.5], [36.5, 46.2], [32.5, 46.2], [32.5, 44.5]
            ]
            
            sevastopol_coords = [
                [33.4, 44.5], [33.7, 44.5], [33.7, 44.7], [33.4, 44.7], [33.4, 44.5]
            ]
            
            crimea_feature = {
                "type": "Feature",
                "properties": {"name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º"},
                "geometry": {"type": "Polygon", "coordinates": [crimea_coords]}
            }
            
            sevastopol_feature = {
                "type": "Feature",
                "properties": {"name": "–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å"},
                "geometry": {"type": "Polygon", "coordinates": [sevastopol_coords]}
            }
            
            geojson["features"].append(crimea_feature)
            geojson["features"].append(sevastopol_feature)
            
            st.success("‚úÖ –ë–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å –ö—Ä—ã–º–æ–º –∏ –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–∞!")
            return geojson
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑–æ–≤–æ–π –∫–∞—Ä—Ç—ã: {e}")
    
    return None

# –ó–∞–≥—Ä—É–∂–∞–µ–º GeoJSON
with st.spinner("–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—É –†–æ—Å—Å–∏–∏..."):
    geojson = load_geojson_with_crimea()

if geojson:
    # –ü–æ–ª–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Ä–µ–≥–∏–æ–Ω–æ–≤
    name_mapping = {
        '–ú–æ—Å–∫–≤–∞': '–ú–æ—Å–∫–≤–∞',
        '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥': '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–¥—ã–≥–µ—è': '–ê–¥—ã–≥–µ—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞–ª–º—ã–∫–∏—è': '–ö–∞–ª–º—ã–∫–∏—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º',
        '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å': '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –î–∞–≥–µ—Å—Ç–∞–Ω': '–î–∞–≥–µ—Å—Ç–∞–Ω',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ò–Ω–≥—É—à–µ—Ç–∏—è': '–ò–Ω–≥—É—à–µ—Ç–∏—è',
        '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞': '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä–∏—è',
        '–ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞': '–ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å–∏—è', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è ‚Äì –ê–ª–∞–Ω–∏—è': '–°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è',
        '–ß–µ—á–µ–Ω—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞': '–ß–µ—á–Ω—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω': '–ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–∞—Ä–∏–π –≠–ª': '–ú–∞—Ä–∏–π –≠–ª',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–æ—Ä–¥–æ–≤–∏—è': '–ú–æ—Ä–¥–æ–≤–∏—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω': '–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω',
        '–£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞': '–£–¥–º—É—Ä—Ç–∏—è',
        '–ß—É–≤–∞—à—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞': '–ß—É–≤–∞—à–∏—è',
        '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥ ‚Äî –Æ–≥—Ä–∞': '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥ ‚Äî –Æ–≥—Ä–∞',
        '–Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥': '–Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥',
        '–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥': '–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–ª—Ç–∞–π': '–ê–ª—Ç–∞–π',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢—ã–≤–∞': '–¢—ã–≤–∞', 
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –•–∞–∫–∞—Å–∏—è': '–•–∞–∫–∞—Å–∏—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë—É—Ä—è—Ç–∏—è': '–ë—É—Ä—è—Ç–∏—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–∞—Ö–∞',
        '–ï–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å': '–ï–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ß—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥': '–ß—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥',
        
        # –û–±–ª–∞—Å—Ç–∏ –∏ –∫—Ä–∞—è
        '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞—Ä–µ–ª–∏—è': '–ö–∞—Ä–µ–ª–∏—è',
        '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–æ–º–∏': '–ö–æ–º–∏',
        '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ü—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ü—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π': '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π',
        '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π': '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π',
        '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π': '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π',
        '–ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ê–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π': '–ê–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π',
        '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π',
        '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π –∫—Ä–∞–π': '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π –∫—Ä–∞–π',
        '–ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π': '–ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π',
        '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π': '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π',
        '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π': '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π',
        '–ê–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ê–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
    }

    def map_region_name(russian_name):
        return name_mapping.get(russian_name, russian_name)

    df['–†–µ–≥–∏–æ–Ω_–Ω–æ—Ä–º'] = df['–†–µ–≥–∏–æ–Ω'].apply(map_region_name)

    # –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
    st.subheader("üó∫Ô∏è –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏")
    
    fig = px.choropleth(
        df,
        geojson=geojson,
        locations='–†–µ–≥–∏–æ–Ω_–Ω–æ—Ä–º',
        featureidkey="properties.name",
        color='–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–Ω–æ—Å—Ç–∏',
        color_continuous_scale="RdYlBu_r",
        range_color=(0, 85),
        scope="world",
        labels={'–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–Ω–æ—Å—Ç–∏': '–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–Ω–æ—Å—Ç–∏'},
        hover_name='–†–µ–≥–∏–æ–Ω',
        hover_data={'–†–∞–Ω–≥': True, '–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–Ω–æ—Å—Ç–∏': False},
        title='–†–µ–π—Ç–∏–Ω–≥ –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏'
    )
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    fig.update_geos(
        visible=False,
        resolution=50,
        showcountries=True,
        countrycolor="black",
        showsubunits=True,
        subunitcolor="gray",
        subunitwidth=0.5,
        fitbounds="locations",
        center={"lat": 60, "lon": 90},
        projection_scale=1.8
    )
    
    fig.update_layout(
        height=700,
        margin={"r":0,"t":50,"l":0,"b":0},
        geo=dict(
            bgcolor='lightblue',
            showland=True,
            landcolor='white'
        )
    )
    
    st.plotly_chart(fig, use_container_width=True)
    
    # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    with st.expander("üîç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤"):
        if 'features' in geojson:
            regions_in_map = [feature['properties']['name'] for feature in geojson['features']]
            regions_in_data = df['–†–µ–≥–∏–æ–Ω_–Ω–æ—Ä–º'].tolist()
            
            missing_in_map = [region for region in regions_in_data if region not in regions_in_map]
            missing_in_data = [region for region in regions_in_map if region not in regions_in_data]
            
            col1, col2 = st.columns(2)
            
            with col1:
                st.write("**–†–µ–≥–∏–æ–Ω—ã –≤ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ –Ω–∞ –∫–∞—Ä—Ç–µ:**")
                for region in missing_in_map:
                    st.write(f"‚ùå {region}")
            
            with col2:
                st.write("**–†–µ–≥–∏–æ–Ω—ã –Ω–∞ –∫–∞—Ä—Ç–µ, –Ω–æ –Ω–µ –≤ –¥–∞–Ω–Ω—ã—Ö:**")
                for region in missing_in_data:
                    st.write(f"‚ùì {region}")
            
            st.write(f"**–í—Å–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ:** {len(regions_in_map)}")
            st.write(f"**–í—Å–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö:** {len(regions_in_data)}")

else:
    st.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.")

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
st.subheader("üìä –¢–æ–ø —Ä–µ–≥–∏–æ–Ω–æ–≤")
col1, col2 = st.columns(2)

with col1:
    st.write("**üî¥ –¢–æ–ø-10 –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö:**")
    for i, row in df.nsmallest(10, '–†–∞–Ω–≥').iterrows():
        st.write(f"{row['–†–∞–Ω–≥']}. {row['–†–µ–≥–∏–æ–Ω']}")

with col2:
    st.write("**üîµ –¢–æ–ø-10 –±–ª–∞–≥–æ–ø–æ–ª—É—á–Ω—ã—Ö:**")
    for i, row in df.nlargest(10, '–†–∞–Ω–≥').iterrows():
        st.write(f"{row['–†–∞–Ω–≥']}. {row['–†–µ–≥–∏–æ–Ω']}")

# –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
st.subheader("üìã –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞")
st.dataframe(df[['–†–µ–≥–∏–æ–Ω', '–†–∞–Ω–≥', '–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–±–ª–µ–º–Ω–æ—Å—Ç–∏']].sort_values('–†–∞–Ω–≥'), use_container_width=True)
